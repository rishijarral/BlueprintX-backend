# BlueprintX Backend - Centralized Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values.
# This single file configures BOTH the Rust API and Python AI services.
# =============================================================================

# =============================================================================
# ENVIRONMENT
# =============================================================================
# Options: dev | staging | prod
ENV=dev

# =============================================================================
# DATABASE - PostgreSQL with pgvector
# =============================================================================
# Shared database for both services
# Note: Python service uses asyncpg driver (prefix added automatically)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=blueprintx
POSTGRES_HOST=db
POSTGRES_PORT=5432

# Connection pool settings (Rust only)
DATABASE_MAX_CONNECTIONS=10

# =============================================================================
# REDIS - Caching and Job Store
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379

# Rust uses db 0, Python uses db 1
REDIS_CACHE_TTL_SECONDS=3600

# =============================================================================
# SECURITY - Internal Service Authentication
# =============================================================================
# Shared secret for Rust <-> Python service communication
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# IMPORTANT: Change this in production!
INTERNAL_API_TOKEN=dev-internal-token-change-in-prod

# =============================================================================
# SUPABASE AUTH (Required)
# =============================================================================
# Replace with your Supabase project values from:
# https://supabase.com/dashboard/project/YOUR_PROJECT/settings/api
SUPABASE_PROJECT_REF=YOUR_PROJECT_REF
SUPABASE_JWT_JWKS_URL=https://${SUPABASE_PROJECT_REF}.supabase.co/auth/v1/.well-known/jwks.json
SUPABASE_JWT_ISSUER=https://${SUPABASE_PROJECT_REF}.supabase.co/auth/v1
SUPABASE_JWT_AUDIENCE=authenticated

# JWKS cache TTL in seconds (default: 30 minutes)
JWKS_CACHE_TTL_SECONDS=1800

# =============================================================================
# GEMINI API (Required)
# =============================================================================
# Get your API key from: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your-gemini-api-key-here

# Model configuration (optional - defaults shown)
GEMINI_MODEL_TEXT=gemini-3-flash-preview
GEMINI_MODEL_VISION=gemini-3-flash-preview
GEMINI_MODEL_FAST=gemini-3-flash-preview
GEMINI_EMBEDDING_MODEL=gemini-embedding-001

# API settings
GEMINI_TIMEOUT_SECONDS=300
GEMINI_MAX_RETRIES=3

# =============================================================================
# CORS (Frontend Origins)
# =============================================================================
# Comma-separated list of allowed origins
CORS_ALLOW_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
# Rust API
RUST_SERVER_ADDR=0.0.0.0:8080
RUST_SERVER_PORT=8080

# Python AI Service
PYTHON_SERVER_HOST=0.0.0.0
PYTHON_SERVER_PORT=8000

# AI Service connection (Rust -> Python)
AI_SERVICE_TIMEOUT_SECONDS=300

# =============================================================================
# VECTOR STORE
# =============================================================================
# Options: pgvector (future: pinecone, qdrant, chroma)
VECTOR_STORE_TYPE=pgvector

# pgvector specific settings
PGVECTOR_COLLECTION_NAME=document_embeddings
PGVECTOR_EMBEDDING_DIMENSIONS=768

# =============================================================================
# DOCUMENT PROCESSING
# =============================================================================
# Maximum file upload size in MB
MAX_UPLOAD_SIZE_MB=100

# PDF to image DPI for OCR processing
PDF_DPI=600

# Text chunking settings for embeddings
CHUNK_SIZE=2000
CHUNK_OVERLAP=400

# =============================================================================
# JOBS
# =============================================================================
# Job store type: memory | redis
# Use 'redis' in production for persistence across restarts
JOB_STORE_TYPE=memory

# =============================================================================
# LOGGING
# =============================================================================
# Rust logging (RUST_LOG format)
RUST_LOG=blueprintx_backend=debug,tower_http=debug,info

# Python logging
LOG_LEVEL=INFO
# Options: json | console
LOG_FORMAT=json
